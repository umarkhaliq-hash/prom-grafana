{
  "__inputs": [
    {
      "name": "DS_MIMIR",
      "label": "Mimir",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "9.0.0"
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "1.0.0"
    }
  ],
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "CPU %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 3},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "blue"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory"},
            "properties": [
              {"id": "unit", "value": "bytes"},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "green"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 2},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "orange"}}
            ]
          }
        ]
      },
      "gridPos": {"h": 6, "w": 12, "x": 0, "y": 0},
      "id": 1,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(rate(process_cpu_seconds_total{app=\"webapp\"}[5m])) * 100",
          "legendFormat": "CPU %",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(process_resident_memory_bytes{app=\"webapp\"})",
          "legendFormat": "Memory",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(process_resident_memory_bytes{app=\"webapp\"}) / (8*1024*1024*1024) * 100",
          "legendFormat": "Memory %",
          "refId": "C"
        }
      ],
      "title": "WebApp - CPU & Memory",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "CPU %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 3},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "purple"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory"},
            "properties": [
              {"id": "unit", "value": "bytes"},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "red"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 2},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "yellow"}}
            ]
          }
        ]
      },
      "gridPos": {"h": 6, "w": 12, "x": 12, "y": 0},
      "id": 2,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(rate(process_cpu_seconds_total{app=\"screener-app\"}[5m])) * 100",
          "legendFormat": "CPU %",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(process_resident_memory_bytes{app=\"screener-app\"})",
          "legendFormat": "Memory",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(process_resident_memory_bytes{app=\"screener-app\"}) / (8*1024*1024*1024) * 100",
          "legendFormat": "Memory %",
          "refId": "C"
        }
      ],
      "title": "Screener App - CPU & Memory",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        },
        "overrides": [
          {
            "matcher": {"id": "byName", "options": "CPU %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 1},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "blue"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory Used"},
            "properties": [
              {"id": "unit", "value": "bytes"},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "green"}}
            ]
          },
          {
            "matcher": {"id": "byName", "options": "Memory %"},
            "properties": [
              {"id": "unit", "value": "percent"},
              {"id": "decimals", "value": 1},
              {"id": "color", "value": {"mode": "fixed", "fixedColor": "orange"}}
            ]
          }
        ]
      },
      "gridPos": {"h": 6, "w": 24, "x": 0, "y": 6},
      "id": 3,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "100 - (avg(rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
          "legendFormat": "CPU %",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes)",
          "legendFormat": "Memory Used",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(100 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100))",
          "legendFormat": "Memory %",
          "refId": "C"
        }
      ],
      "title": "Node - CPU & Memory",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
      "id": 4,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "rate(container_cpu_usage_seconds_total{pod=~\"webapp-deployment.*\", container!=\"POD\"}[5m]) * 100",
          "legendFormat": "{{pod}} CPU",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "rate(container_cpu_usage_seconds_total{pod=~\"screener-deployment.*\", container!=\"POD\"}[5m]) * 100",
          "legendFormat": "{{pod}} CPU",
          "refId": "B"
        }
      ],
      "title": "Pod CPU Usage Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
      "id": 5,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_memory_usage_bytes{pod=~\"webapp-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_memory_usage_bytes{pod=~\"screener-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory",
          "refId": "B"
        }
      ],
      "title": "Pod Memory Usage Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 20},
      "id": 6,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_spec_memory_limit_bytes{pod=~\"webapp-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory Limit",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_memory_usage_bytes{pod=~\"webapp-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory Usage",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_spec_memory_limit_bytes{pod=~\"screener-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory Limit",
          "refId": "C"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "container_memory_usage_bytes{pod=~\"screener-deployment.*\", container!=\"POD\"}",
          "legendFormat": "{{pod}} Memory Usage",
          "refId": "D"
        }
      ],
      "title": "Container Resource Limits vs Usage",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 20},
      "id": 7,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_resident_memory_bytes{instance=\"10.244.0.11:4000\"}",
          "legendFormat": "Webapp RSS Memory",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_resident_memory_bytes{instance=\"10.244.0.10:5000\"}",
          "legendFormat": "Screener RSS Memory",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_open_fds{instance=\"10.244.0.11:4000\"} * 1000000",
          "legendFormat": "Webapp File Descriptors (x1M)",
          "refId": "C"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_open_fds{instance=\"10.244.0.10:5000\"} * 1000000",
          "legendFormat": "Screener File Descriptors (x1M)",
          "refId": "D"
        }
      ],
      "title": "Application Process Metrics",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 28},
      "id": 8,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "rate(python_gc_collections_total{instance=\"10.244.0.11:4000\"}[5m])",
          "legendFormat": "Webapp GC Gen {{generation}}",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "rate(python_gc_collections_total{instance=\"10.244.0.10:5000\"}[5m])",
          "legendFormat": "Screener GC Gen {{generation}}",
          "refId": "B"
        }
      ],
      "title": "Python Garbage Collection",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "unit": "bytes",
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 28},
      "id": 9,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_virtual_memory_bytes{instance=\"10.244.0.11:4000\"}",
          "legendFormat": "Webapp Virtual Memory",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "process_virtual_memory_bytes{instance=\"10.244.0.10:5000\"}",
          "legendFormat": "Screener Virtual Memory",
          "refId": "B"
        }
      ],
      "title": "Virtual Memory Usage",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 8, "w": 24, "x": 0, "y": 36},
      "id": 10,
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "node_load1",
          "legendFormat": "Node Load 1m",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "node_load5",
          "legendFormat": "Node Load 5m",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "100 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100)",
          "legendFormat": "Node Memory Usage %",
          "refId": "C"
        }
      ],
      "title": "Node & Cluster Overview",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_MIMIR}"
      },
      "fieldConfig": {
        "defaults": {
          "color": {"mode": "palette-classic"}
        }
      },
      "gridPos": {"h": 6, "w": 24, "x": 0, "y": 44},
      "id": 11,
      "options": {
        "colorMode": "background",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "auto",
        "reduceOptions": {
          "values": false,
          "calcs": ["lastNotNull"],
          "fields": ""
        },
        "textMode": "auto"
      },
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "count(container_memory_usage_bytes{pod=~\"webapp-deployment.*\", container!=\"POD\"})",
          "legendFormat": "Webapp Pods",
          "refId": "A"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "count(container_memory_usage_bytes{pod=~\"screener-deployment.*\", container!=\"POD\"})",
          "legendFormat": "Screener Pods",
          "refId": "B"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "avg(rate(container_cpu_usage_seconds_total{pod=~\"(webapp|screener)-deployment.*\", container!=\"POD\"}[5m])) * 100",
          "legendFormat": "Avg CPU %",
          "refId": "C"
        },
        {
          "datasource": {"type": "prometheus", "uid": "${DS_MIMIR}"},
          "expr": "sum(container_memory_usage_bytes{pod=~\"(webapp|screener)-deployment.*\", container!=\"POD\"})",
          "legendFormat": "Total Memory",
          "refId": "D"
        }
      ],
      "title": "Apps Summary Stats",
      "type": "stat"
    }
  ],
  "refresh": "5s",
  "schemaVersion": 37,
  "style": "dark",
  "tags": ["webapp", "screener-app", "monitoring"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "PERFECT Apps Monitoring Dashboard",
  "uid": "perfect-app-dash",
  "version": 1,
  "weekStart": ""
}